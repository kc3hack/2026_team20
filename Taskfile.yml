version: "3"

dotenv:
  - ".env"

vars:
  DOPPLER_CMD:
    sh: |
      if command -v doppler >/dev/null 2>&1; then
        echo "doppler run --"
      else
        echo ""
      fi

  COMPOSE_CMD:
    sh: |
      if command -v docker compose >/dev/null 2>&1; then echo "docker compose"; elif command -v docker-compose >/dev/null 2>&1; then echo "docker-compose"; else echo "docker compose"; fi

includes:
  frontend:
    taskfile: ./taskfile/Taskfile.frontend.yml
    dir: ./frontend

  backend:
    taskfile: ./taskfile/Taskfile.backend.yml
    dir: ./backend

tasks:
  default:
    desc: åˆ©ç”¨å¯èƒ½ãªã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’è¡¨ç¤º
    cmd: task --list

  # ----------------------------------------------------------------
  # å…¨ä½“æ“ä½œã‚³ãƒãƒ³ãƒ‰
  # ----------------------------------------------------------------
  dev:
    desc: ğŸš€ ãƒ•ãƒ­ãƒ³ãƒˆã¨ãƒãƒƒã‚¯ã‚’åŒæ™‚ã«èµ·å‹• (DopplerçµŒç”±)
    cmd: "{{.DOPPLER_CMD}} task dev:start"

  dev:start:
    deps:
      - task: backend:dev
      - task: frontend:dev

  install:
    desc: ğŸ“¦ å…¨ä½“ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    deps:
      - task: backend:install
      - task: frontend:install

  # ----------------------------------------------------------------
  # ã‚¤ãƒ³ãƒ•ãƒ©é–¢é€£
  # ----------------------------------------------------------------
  up:
    desc: DBã‚³ãƒ³ãƒ†ãƒŠãªã©ã‚’èµ·å‹•
    cmd: "{{.DOPPLER_CMD}} {{.COMPOSE_CMD}} up -d"

  down:
    desc: ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢
    cmd: "{{.DOPPLER_CMD}} {{.COMPOSE_CMD}} down"
