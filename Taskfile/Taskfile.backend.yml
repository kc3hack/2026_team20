version: "3"

vars:
  INFISICAL_RUN:
    sh: |
      if [ -z "$INFISICAL_PROJECT_ID" ] && command -v infisical >/dev/null 2>&1; then
        echo "infisical run --env=dev -- "
      else
        echo ""
      fi

tasks:
  install:
    desc: Python依存関係のインストール (uv)
    cmds:
      - uv sync

  dev:
    desc: FastAPIサーバーの起動
    cmds:
      - "{{.INFISICAL_RUN}} uv run fastapi dev app/main.py"

  gen-types:
    desc: (内部用) サーバーを起動してOpenAPIを公開
    cmds:
      - "{{.INFISICAL_RUN}} uv run fastapi dev app/main.py --port 8000"
