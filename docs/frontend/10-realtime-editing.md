# ã‚»ã‚¯ã‚·ãƒ§ãƒ³å˜ä½ç·¨é›† + ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ ä»•æ§˜æ›¸

> **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** ç¢ºå®šä»•æ§˜
> **æœ€çµ‚æ›´æ–°:** 2026-02-19

---

## æ¦‚è¦

Plotï¼ˆè¨˜äº‹ï¼‰ã®ç·¨é›†ã¯**ã‚»ã‚¯ã‚·ãƒ§ãƒ³å˜ä½**ã§è¡Œã‚ã‚Œã‚‹ã€‚1 ã¤ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’åŒæ™‚ã«ç·¨é›†ã§ãã‚‹ã®ã¯ **1 äººã ã‘**ï¼ˆæ’ä»–ãƒ­ãƒƒã‚¯ï¼‰ã€‚ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ­ãƒƒã‚¯ä¸­ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç·¨é›†ã§ããªã„ãŒã€**ç·¨é›†ä¸­ã®å†…å®¹ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åŒæœŸã•ã‚Œã€é–²è¦§ã™ã‚‹ã“ã¨ã¯å¯èƒ½**ã€‚

### ä»•æ§˜ã® 3 æœ¬æŸ±

| é …ç›® | å†…å®¹ |
|------|------|
| **ã‚»ã‚¯ã‚·ãƒ§ãƒ³å˜ä½ç·¨é›†** | Plot å…¨ä½“ã§ã¯ãªãã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè¦‹å‡ºã—ï¼‹æœ¬æ–‡ã®ã¾ã¨ã¾ã‚Šï¼‰ã”ã¨ã«å€‹åˆ¥ã«ç·¨é›†ã§ãã‚‹ |
| **æ’ä»–ãƒ­ãƒƒã‚¯** | èª°ã‹ãŒç·¨é›†ä¸­ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç·¨é›†é–‹å§‹ã§ããªã„ã€‚ã€ŒğŸ”’ {ãƒ¦ãƒ¼ã‚¶ãƒ¼å} ãŒç·¨é›†ä¸­ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ |
| **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ** | ç·¨é›†ä¸­ã®ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›´ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ä»–ã®é–²è¦§è€…ã«åæ˜ ã•ã‚Œã‚‹ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ã¨ã—ã¦è¡¨ç¤ºï¼‰ |

---

## æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ä½¿ç”¨æŠ€è¡“

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | æŠ€è¡“ | ç”¨é€” |
|---------|------|------|
| **ã‚¨ãƒ‡ã‚£ã‚¿** | Tiptap + ProseMirror | ãƒªãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆç·¨é›† |
| **CRDT + ãƒ­ãƒƒã‚¯ç®¡ç†** | Y.js + y-prosemirror + **Y.js Awareness** | ç·¨é›†å†…å®¹ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ + **ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã®å…±æœ‰** |
| **é€šä¿¡** | Supabase Realtime (WebSocket) | Y.js ã®åŒæœŸãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆ + Awareness çŠ¶æ…‹é…ä¿¡ |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ°¸ç¶šåŒ–** | REST API (FastAPI) | ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…å®¹ã®ä¿å­˜ï¼ˆ`PUT /sections/{id}`ï¼‰ |

> [!IMPORTANT]
> **ãƒ­ãƒƒã‚¯ç®¡ç†ã« REST API ã¯ä½¿ã‚ãªã„ã€‚** Y.js ã® Awareness ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒãƒ­ãƒƒã‚¯çŠ¶æ…‹ã®å…±æœ‰ãƒ»ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ»åˆ‡æ–­æ™‚ã®è‡ªå‹•è§£æ”¾ã‚’ã™ã¹ã¦æ‹…ã†ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ãƒ­ãƒƒã‚¯ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ä¸è¦ã€‚

### é€šä¿¡ãƒ¬ã‚¤ãƒ¤ãƒ¼å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ–ãƒ©ã‚¦ã‚¶                                                     â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ TiptapEditor â”‚â—„â”€â”€â–ºâ”‚ Y.js Doc     â”‚â”€â”€â–ºâ”‚ y-prosemirror   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                    â”‚ Y.js Awareness  â”‚  â† ãƒ­ãƒƒã‚¯çŠ¶æ…‹ç®¡ç†      â”‚
â”‚                    â”‚ (èª°ãŒã©ã®ã‚»ã‚¯ã‚·  â”‚                       â”‚
â”‚                    â”‚  ãƒ§ãƒ³ã‚’ç·¨é›†ä¸­ã‹) â”‚                       â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                             â”‚                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                    â”‚ Supabase        â”‚                       â”‚
â”‚                    â”‚ Realtime Client â”‚                       â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯               â”‚ WebSocket                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Supabase Server            â”‚                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                    â”‚ Realtime Server â”‚                       â”‚
â”‚                    â”‚  - Broadcast    â”‚   â† Y.js å·®åˆ†é…ä¿¡     â”‚
â”‚                    â”‚  - Presence     â”‚   â† Awareness çŠ¶æ…‹    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FastAPI                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Sections â”‚ â”‚ History (æ“ä½œãƒ­ã‚°/SS)     â”‚                  â”‚
â”‚  â”‚ CRUD     â”‚ â”‚ hot_operations /          â”‚                  â”‚
â”‚  â”‚          â”‚ â”‚ cold_snapshots            â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ­ãƒƒã‚¯ç®¡ç†: Y.js Awareness

### ãªãœ Y.js Awarenessï¼Ÿ

| é …ç›® | REST API ãƒ­ãƒƒã‚¯ | Y.js Awareness |
|------|----------------|---------------|
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä½œæ¥­ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ3ã¤å¿…è¦ | **ä¸è¦** |
| ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ | è‡ªå‰å®Ÿè£… | **Y.js å†…è”µ**ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ30ç§’ï¼‰ |
| åˆ‡æ–­æ™‚ã®è§£æ”¾ | sendBeacon + ã‚µãƒ¼ãƒãƒ¼ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | **è‡ªå‹•**ï¼ˆAwareness ãŒæ¶ˆãˆã‚‹ï¼‰ |
| å®Ÿè£…é‡ | ãƒ•ãƒ­ãƒ³ãƒˆï¼‹ãƒãƒƒã‚¯ä¸¡æ–¹ | **ãƒ•ãƒ­ãƒ³ãƒˆã®ã¿** |

### Awareness çŠ¶æ…‹ã®å®šç¾©

```typescript
// lib/realtime/types.ts
interface SectionAwarenessState {
  /** ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± */
  user: {
    id: string;
    displayName: string;
    avatarUrl: string | null;
  };
  /** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç·¨é›†ä¸­ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³IDï¼ˆnull = é–²è¦§ã®ã¿ï¼‰ */
  editingSectionId: string | null;
}
```

### ãƒ­ãƒƒã‚¯ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

```mermaid
stateDiagram-v2
    [*] --> Unlocked : ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆæœŸçŠ¶æ…‹

    Unlocked --> LockedByMe : ç·¨é›†ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ï¼ˆAwareness ã« editingSectionId ã‚’ã‚»ãƒƒãƒˆï¼‰
    Unlocked --> LockedByOther : ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® Awareness ãŒ editingSectionId ã‚’ã‚»ãƒƒãƒˆ

    LockedByMe --> Unlocked : ç·¨é›†å®Œäº† / ãƒšãƒ¼ã‚¸é›¢è„±ï¼ˆAwareness ã‚¯ãƒªã‚¢ / è‡ªå‹•ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰
    LockedByMe --> LockedByMe : Y.js Awareness ãŒè‡ªå‹•ã§ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ

    LockedByOther --> Unlocked : ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® Awareness ãŒæ¶ˆãˆã‚‹ï¼ˆç·¨é›†å®Œäº† or åˆ‡æ–­ï¼‰
    LockedByOther --> LockedByOther : ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å†…å®¹åŒæœŸï¼ˆé–²è¦§ã®ã¿ï¼‰
```

### ãƒ­ãƒƒã‚¯å–å¾—ã€œè§£æ”¾ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant UserA as ãƒ¦ãƒ¼ã‚¶ãƒ¼ Aï¼ˆç·¨é›†è€…ï¼‰
    participant Frontend as ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
    participant Yjs as Y.js Awareness
    participant RT as Supabase Realtime
    participant UserB as ãƒ¦ãƒ¼ã‚¶ãƒ¼ Bï¼ˆé–²è¦§è€…ï¼‰

    UserA->>Frontend: ã€Œç·¨é›†ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    Frontend->>Frontend: Awareness ã«ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒã˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç·¨é›†ä¸­ã‹ç¢ºèª
    alt ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ç©ºã„ã¦ã„ã‚‹
        Frontend->>Yjs: awareness.setLocalState({ editingSectionId: sectionId, user })
        Yjs->>RT: Awareness çŠ¶æ…‹ã‚’ Broadcast
        RT-->>UserB: Awareness æ›´æ–°é€šçŸ¥
        UserB->>UserB: ã€ŒğŸ”’ ãƒ¦ãƒ¼ã‚¶ãƒ¼A ãŒç·¨é›†ä¸­ã€è¡¨ç¤º
    else ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç·¨é›†ä¸­
        Frontend->>Frontend: toast.error("ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ â—‹â—‹ ãŒç·¨é›†ä¸­ã§ã™")
    end

    loop ç·¨é›†ä¸­
        UserA->>Frontend: ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
        Frontend->>RT: Y.js å·®åˆ†ã‚’ Broadcast
        RT-->>UserB: Y.js å·®åˆ†ã‚’å—ä¿¡
        UserB->>UserB: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å†…å®¹ãŒæ›´æ–°ã•ã‚Œã‚‹ï¼ˆé–²è¦§ã®ã¿ï¼‰
    end

    UserA->>Frontend: ã€Œç·¨é›†å®Œäº†ã€or ãƒšãƒ¼ã‚¸é›¢è„±
    Frontend->>Yjs: awareness.setLocalState({ editingSectionId: null, user })
    Frontend->>Frontend: PUT /sections/{id} ã§æœ€çµ‚ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¿å­˜
    Yjs->>RT: Awareness çŠ¶æ…‹ã‚’ Broadcast
    RT-->>UserB: Awareness æ›´æ–°é€šçŸ¥
    UserB->>UserB: ãƒ­ãƒƒã‚¯è§£é™¤è¡¨ç¤ºã€æœ€æ–°å†…å®¹ã§è¡¨ç¤ºæ›´æ–°
```

### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆè‡ªå‹•ï¼‰

- Y.js Awareness ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: **30 ç§’**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ‡æ–­ã—ãŸå ´åˆã€30 ç§’å¾Œã«ä»–ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã® Awareness ã‹ã‚‰è‡ªå‹•çš„ã«å‰Šé™¤ã•ã‚Œã‚‹
- **è¿½åŠ å®Ÿè£…ã¯ä¸è¦** â€” Y.js ãŒå†…è”µã®ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å‡¦ç†ã™ã‚‹

### æ¥ç¶šåˆæœŸã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
Awareness ã«æ¥ç¶šã™ã‚‹ã¾ã§ã®é–“ã€ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã¯ä¸æ˜ã¨ãªã‚‹ã€‚

- **åˆæœŸçŠ¶æ…‹:** `lockState = "unknown"` (ã¾ãŸã¯ `loading`)
- **UI è¡¨ç¤º:** ã€Œâ³ æ¥ç¶šä¸­...ã€ç­‰ã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã€ã¾ãŸã¯ç·¨é›†ãƒœã‚¿ãƒ³ã‚’éæ´»æ€§åŒ–
- **æ¥ç¶šå®Œäº†:** Awareness ã®åŒæœŸãŒå®Œäº†ã—ãŸæ™‚ç‚¹ã§ `lockState` ãŒ `unlocked` / `locked-by-other` ã«ç¢ºå®šã™ã‚‹

---

## Supabase Realtime ãƒãƒ£ãƒãƒ«è¨­è¨ˆ

### ãƒãƒ£ãƒãƒ«å‘½åè¦å‰‡

| ãƒãƒ£ãƒãƒ«å | ç”¨é€” | æ©Ÿèƒ½ |
|-----------|------|------|
| `plot:{plotId}` | Plot å…¨ä½“ã®é€šä¿¡ | Y.js å·®åˆ†ã® Broadcast + Awarenessï¼ˆãƒ­ãƒƒã‚¯çŠ¶æ…‹å…±æœ‰ï¼‰ |

> **ãƒãƒ£ãƒãƒ«ã¯ Plot å˜ä½ã§ 1 ã¤ã ã‘ã€‚** ã‚»ã‚¯ã‚·ãƒ§ãƒ³å˜ä½ã®ãƒãƒ£ãƒãƒ«ã¯ä¸è¦ã€‚Y.js Doc ã¯ Plot å…¨ä½“ã§ 1 ã¤å…±æœ‰ã—ã€Awareness ã® `editingSectionId` ã§ã€Œã©ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’èª°ãŒç·¨é›†ã—ã¦ã„ã‚‹ã‹ã€ã‚’ç®¡ç†ã™ã‚‹ã€‚

### Broadcast ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰

```typescript
// Y.js ã®æ›´æ–°å·®åˆ†ã‚’é…ä¿¡
interface YjsSyncMessage {
  type: "yjs-update";
  /** Y.js ã®æ›´æ–°ãƒã‚¤ãƒŠãƒªã‚’ Base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸã‚‚ã® */
  update: string;
  /** é€ä¿¡è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆè‡ªåˆ†ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç„¡è¦–ã™ã‚‹ãŸã‚ï¼‰ */
  senderId: string;
}
```

---

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ã‚¬ã‚¤ãƒ‰

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ realtime/                     # Supabase Realtime + Y.js ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚       â”œâ”€â”€ channel.ts               #   ãƒãƒ£ãƒãƒ«ä½œæˆãƒ»ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ awareness.ts             #   Y.js Awareness ãƒ©ãƒƒãƒ‘ãƒ¼ (ãƒ­ãƒƒã‚¯çŠ¶æ…‹ç®¡ç†)
â”‚       â””â”€â”€ types.ts                 #   SectionAwarenessState, YjsSyncMessage ç­‰
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useSectionLock.ts            #   ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ãƒƒã‚¯ç®¡ç† (Y.js Awareness ãƒ™ãƒ¼ã‚¹)
â”‚   â””â”€â”€ useRealtimeSection.ts        #   ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…å®¹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
â”‚
â””â”€â”€ components/
    â””â”€â”€ section/
        â”œâ”€â”€ SectionEditor/
        â”‚   â”œâ”€â”€ SectionEditor.tsx    #   ç·¨é›†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆãƒ­ãƒƒã‚¯çµ±åˆï¼‰
        â”‚   â””â”€â”€ SectionEditor.module.scss
        â”œâ”€â”€ SectionViewer/
        â”‚   â”œâ”€â”€ SectionViewer.tsx    #   é–²è¦§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°å¯¾å¿œï¼‰
        â”‚   â””â”€â”€ SectionViewer.module.scss
        â””â”€â”€ SectionLockBadge/
            â”œâ”€â”€ SectionLockBadge.tsx #   ã€ŒğŸ”’ â—‹â—‹ãŒç·¨é›†ä¸­ã€ãƒãƒƒã‚¸
            â””â”€â”€ SectionLockBadge.module.scss
```

### Hook è©³ç´°ä»•æ§˜

#### `useSectionLock(sectionId: string)`

Y.js Awareness ãƒ™ãƒ¼ã‚¹ã§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ  Hookã€‚

```typescript
interface UseSectionLockReturn {
  /** ãƒ­ãƒƒã‚¯çŠ¶æ…‹ï¼ˆunknown = æ¥ç¶šå‰ï¼‰ */
  lockState: "unknown" | "unlocked" | "locked-by-me" | "locked-by-other";
  /** ãƒ­ãƒƒã‚¯ä¿æŒè€…ã®æƒ…å ±ï¼ˆè‡ªåˆ†ä»¥å¤–ãŒãƒ­ãƒƒã‚¯ä¸­ã®å ´åˆï¼‰ */
  lockedBy: { id: string; displayName: string; avatarUrl: string | null } | null;
  /** ãƒ­ãƒƒã‚¯å–å¾—ï¼ˆAwareness ã« editingSectionId ã‚’ã‚»ãƒƒãƒˆï¼‰ */
  acquireLock: () => boolean;
  /** ãƒ­ãƒƒã‚¯è§£æ”¾ï¼ˆAwareness ã® editingSectionId ã‚’ null ã«ï¼‰ */
  releaseLock: () => void;
}
```

**å†…éƒ¨å‹•ä½œ:**
1. `acquireLock()` å‘¼ã³å‡ºã— â†’ Awareness çŠ¶æ…‹ã‚’ç¢ºèª â†’ ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒã˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç·¨é›†ä¸­ãªã‚‰ `false` ã‚’è¿”ã™
2. ç©ºã„ã¦ã„ã‚Œã° `awareness.setLocalState({ editingSectionId: sectionId, user })` â†’ `true` ã‚’è¿”ã™
3. `releaseLock()` å‘¼ã³å‡ºã— or `useEffect` ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— â†’ `awareness.setLocalState({ editingSectionId: null, user })`
4. ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® Awareness å¤‰æ›´ã‚’ `awareness.on("change")` ã§ç›£è¦– â†’ `lockState` ã‚’è‡ªå‹•æ›´æ–°

#### `useRealtimeSection(sectionId: string, enabled: boolean)`

ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…å®¹ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚’ç®¡ç†ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ  Hookã€‚

```typescript
interface UseRealtimeSectionReturn {
  /** ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°ã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆTiptap JSONï¼‰ */
  liveContent: Record<string, unknown> | null;
  /** æ¥ç¶šçŠ¶æ…‹ */
  connectionStatus: "connecting" | "connected" | "disconnected";
}
```

**å†…éƒ¨å‹•ä½œ:**
1. `plot:{plotId}` Broadcast ãƒãƒ£ãƒãƒ«ã‚’è³¼èª­
2. Y.js å·®åˆ†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ â†’ ãƒ­ãƒ¼ã‚«ãƒ«ã® Y.js Doc ã«é©ç”¨ â†’ Tiptap ã‚¨ãƒ‡ã‚£ã‚¿ã«åæ˜ 
3. ç·¨é›†è€…å´: `editor.on("update")` â†’ Y.js å·®åˆ†ã‚’ Broadcast ãƒãƒ£ãƒãƒ«ã«é€ä¿¡

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°

#### `SectionEditor` â€” ãƒ­ãƒƒã‚¯çµ±åˆç‰ˆ

```typescript
interface SectionEditorProps {
  section: SectionResponse;
  /** ãƒ­ãƒƒã‚¯çŠ¶æ…‹ï¼ˆè¦ªã‹ã‚‰æ¸¡ã•ã‚Œã‚‹ï¼‰ */
  lockState: "unknown" | "unlocked" | "locked-by-me" | "locked-by-other";
  /** ãƒ­ãƒƒã‚¯ä¿æŒè€…æƒ…å ± */
  lockedBy: { id: string; displayName: string; avatarUrl: string | null } | null;
  /** ä¿å­˜ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */
  onSave: (title: string, content: Record<string, unknown>) => void;
  /** ç·¨é›†é–‹å§‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆãƒ­ãƒƒã‚¯å–å¾—ã‚’ãƒˆãƒªã‚¬ãƒ¼ï¼‰ */
  onEditStart: () => void;
  /** ç·¨é›†çµ‚äº†ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆãƒ­ãƒƒã‚¯è§£æ”¾ã‚’ãƒˆãƒªã‚¬ãƒ¼ï¼‰ */
  onEditEnd: () => void;
}
```

**ã€Œç·¨é›†ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã®å‹•ä½œ:**
1. **æœªãƒ­ã‚°ã‚¤ãƒ³** â†’ ç·¨é›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã€ãƒ­ã‚°ã‚¤ãƒ³ã‚’ä¿ƒã™ï¼ˆ`toast` or ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸èª˜å°ï¼‰
2. **ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ + ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç©ºã** â†’ ãã®ã¾ã¾ **ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹** ã§ç·¨é›†çŠ¶æ…‹ã¸ï¼ˆãƒšãƒ¼ã‚¸é·ç§»ãªã—ï¼‰
3. **ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ + ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç·¨é›†ä¸­** â†’ `toast.error("ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ â—‹â—‹ ãŒç·¨é›†ä¸­ã§ã™")`

**UI ã®çŠ¶æ…‹é·ç§»:**

| `lockState` | è¡¨ç¤º |
|-------------|------|
| `unknown` | ã€Œâ³ æ¥ç¶šä¸­...ã€or éæ´»æ€§ã®ç·¨é›†ãƒœã‚¿ãƒ³ |
| `unlocked` | é–²è¦§è¡¨ç¤º + ã€Œâœï¸ ç·¨é›†ã™ã‚‹ã€ãƒœã‚¿ãƒ³ |
| `locked-by-me` | Tiptap ã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆç·¨é›†å¯èƒ½ï¼‰+ ã€Œâœ… ç·¨é›†å®Œäº†ã€ãƒœã‚¿ãƒ³ |
| `locked-by-other` | é–²è¦§è¡¨ç¤ºï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ï¼‰+ ã€ŒğŸ”’ {ãƒ¦ãƒ¼ã‚¶ãƒ¼å} ãŒç·¨é›†ä¸­ã€ãƒãƒƒã‚¸ |

> **ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ç·¨é›†**: `/plots/[id]/edit` ã¸ã®é·ç§»ã¯**è¡Œã‚ãªã„**ã€‚Plot è©³ç´°ãƒšãƒ¼ã‚¸ï¼ˆ`/plots/[id]`ï¼‰ä¸Šã§ç›´æ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç·¨é›†ã™ã‚‹ã€‚

#### `SectionLockBadge`

```typescript
interface SectionLockBadgeProps {
  lockedBy: { id: string; displayName: string; avatarUrl: string | null };
  className?: string;
}
```

- `<Avatar>` (å°) + `<Badge variant="secondary">ğŸ”’ {displayName} ãŒç·¨é›†ä¸­</Badge>`
- èƒŒæ™¯è‰²: åŠé€æ˜ã®é»„è‰²ï¼ˆè­¦å‘Šè‰²ï¼‰ã§ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’è¦–è¦šçš„ã«ç¤ºã™
- ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€Œãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç·¨é›†ä¸­ã€ã‚’ç¤ºå”†

#### `SectionViewer` â€” ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ç‰ˆ

```typescript
interface SectionViewerProps {
  section: SectionResponse;
  /** ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹ */
  enableRealtime?: boolean;
  /** èª°ã‹ãŒç·¨é›†ä¸­ã‹ã©ã†ã‹ */
  isBeingEdited?: boolean;
  /** ç·¨é›†è€…æƒ…å ± */
  editedBy?: { id: string; displayName: string; avatarUrl: string | null } | null;
}
```

- `enableRealtime === true` ã®å ´åˆ:
  - `useRealtimeSection(section.id, true)` ã‚’å†…éƒ¨ã§å‘¼ã³å‡ºã—
  - å—ä¿¡ã—ãŸ `liveContent` ã§ Tiptap ã® content ã‚’æ›´æ–°ï¼ˆ`editable: false` ã®ã¾ã¾ï¼‰
  - ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ ã«å¾®å¦™ãªé’è‰²ã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä»˜ä¸ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ä¸­ã‚’ç¤ºã™ï¼‰
- `isBeingEdited === true` ã®å ´åˆ:
  - `SectionLockBadge` ã‚’ã‚»ã‚¯ã‚·ãƒ§ãƒ³å³ä¸Šã«è¡¨ç¤º

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ãƒ­ãƒƒã‚¯é–¢é€£ã®ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹

| ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ | åŸå›  | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å¯¾å‡¦ |
|-------------|------|---------------------|
| **ãƒ­ãƒƒã‚¯å–å¾—å¤±æ•—** | ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ Awareness ã§åŒä¸€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç·¨é›†ä¸­ | `toast.error("ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ ${displayName} ãŒç·¨é›†ä¸­ã§ã™")` + é–²è¦§ãƒ¢ãƒ¼ãƒ‰ç¶­æŒ |
| **ç·¨é›†ä¸­ã«ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ‡æ–­** | Awareness ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ30ç§’ï¼‰ | ãƒ­ãƒƒã‚¯è‡ªå‹•è§£é™¤ã€‚UI ã¯è‡ªå‹•æ›´æ–° |
| **ä¿å­˜å¤±æ•— (403)** | Plot ä¸€æ™‚åœæ­¢ | `toast.error("ã“ã®Plotã¯ç·¨é›†ãŒä¸€æ™‚åœæ­¢ã•ã‚Œã¦ã„ã¾ã™")` |
| **WebSocket åˆ‡æ–­** | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³ | å†æ¥ç¶šã‚’è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã€‚å¤±æ•— â†’ `toast.error("æ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã¾ã—ãŸ")` + é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã™ |
| **æœªãƒ­ã‚°ã‚¤ãƒ³ã§ç·¨é›†ã‚¯ãƒªãƒƒã‚¯** | èªè¨¼ãªã— | `toast.error("ç·¨é›†ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™")` + ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸èª˜å° |

---

## Plot è©³ç´°ãƒšãƒ¼ã‚¸ (`/plots/[id]`) ã§ã®çµ±åˆ

### ãƒšãƒ¼ã‚¸å…¨ä½“ã®ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    A["ãƒšãƒ¼ã‚¸è¡¨ç¤º"] --> B["usePlotDetail(id) ã§Plotãƒ‡ãƒ¼ã‚¿å–å¾—"]
    A["ãƒšãƒ¼ã‚¸è¡¨ç¤º"] --> B["usePlotDetail(id) ã§Plotãƒ‡ãƒ¼ã‚¿å–å¾—"]
    B --> C["plot:{plotId} ãƒãƒ£ãƒãƒ«ã§ Y.js Awareness ã‚’è³¼èª­"]
    C --> D["Awareness å¤‰æ›´ã‚’ç›£è¦– â†’ å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã® lockState ã‚’æ›´æ–°"]
    D --> E["æ¥ç¶šå®Œäº†ã¾ã§å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€Œunknownã€çŠ¶æ…‹"]

    E --> F{"ã‚»ã‚¯ã‚·ãƒ§ãƒ³ N ã®ãƒ­ãƒƒã‚¯çŠ¶æ…‹?"}

    F -->|unlocked| G["SectionViewer + ã€Œç·¨é›†ã™ã‚‹ã€ãƒœã‚¿ãƒ³"]
    F -->|locked-by-me| H["SectionEditorï¼ˆTiptap ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼‰"]
    F -->|locked-by-other| I["SectionViewerï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ï¼‰+ SectionLockBadge"]

    G -->|"ã€Œç·¨é›†ã™ã‚‹ã€ã‚¯ãƒªãƒƒã‚¯"| J{"ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿?"}
    J -->|No| K["toast: ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™"]
    J -->|Yes| L["useSectionLock.acquireLock()"]
    L -->|æˆåŠŸ| H
    L -->|å¤±æ•—| M["toast.error: â—‹â—‹ãŒç·¨é›†ä¸­ã§ã™"]

    H -->|"ã€Œç·¨é›†å®Œäº†ã€ã‚¯ãƒªãƒƒã‚¯"| N["useSectionLock.releaseLock() + PUT /sections/{id}"]
    N --> G
```

### è¤‡æ•°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®åŒæ™‚ç·¨é›†

- 1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒæ™‚ã«ç·¨é›†ã§ãã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ **1 ã¤ã®ã¿**
- åˆ¥ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã€Œç·¨é›†ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ç¾åœ¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ­ãƒƒã‚¯ã‚’å…ˆã«è§£æ”¾ã—ã¦ã‹ã‚‰æ–°ã—ã„ãƒ­ãƒƒã‚¯ã‚’å–å¾—
- ç•°ãªã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã‚Œãã‚Œ **åˆ¥ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³** ã‚’åŒæ™‚ã«ç·¨é›†ã§ãã‚‹

### åˆæœŸãƒ­ãƒƒã‚¯çŠ¶æ…‹ã®å–å¾—
REST API ã«ãƒ­ãƒƒã‚¯æƒ…å ±ã¯æŒãŸãšã€**ã™ã¹ã¦ Y.js Awareness ã®åŒæœŸã‚’å¾…ã¤**ã€‚
ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ç›´å¾Œã¯ãƒ­ãƒƒã‚¯çŠ¶æ…‹ãŒä¸æ˜ãªãŸã‚ã€UI å´ã§ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºï¼ˆSkeleton ã‚„ Disabled ãƒœã‚¿ãƒ³ï¼‰ã‚’è¡Œã†ã€‚Awareness ãŒåŒæœŸã•ã‚ŒãŸç¬é–“ã«æœ€æ–°ã®ãƒ­ãƒƒã‚¯çŠ¶æ…‹ãŒåæ˜ ã•ã‚Œã‚‹ã€‚

---

## ä½¿ç”¨ã™ã‚‹ APIï¼ˆ`docs/api.md` ã«å®šç¾©æ¸ˆã¿ã®ã‚‚ã®ã®ã¿ï¼‰

| API | ç”¨é€” |
|-----|------|
| `GET /plots/{plotId}` | Plot è©³ç´°å–å¾— |
| `PUT /sections/{sectionId}` | ç·¨é›†å®Œäº†æ™‚ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¿å­˜ |
| `POST /plots/{plotId}/sections` | ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ  |
| `DELETE /sections/{sectionId}` | ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‰Šé™¤ |

> [!WARNING]
> ãƒ­ãƒƒã‚¯é–¢é€£ã® REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯**å­˜åœ¨ã—ãªã„**ã€‚`POST /sections/{id}/lock` ç­‰ã¯ä½¿ã‚ãªã„ã“ã¨ã€‚ãƒ­ãƒƒã‚¯ç®¡ç†ã¯ã™ã¹ã¦ Y.js Awareness ã§è¡Œã†ã€‚

---

## æ³¨æ„äº‹é …ãƒ»åˆ¶ç´„

> [!WARNING]
> - Y.js ã® CRDT åŒæœŸã¯ **Supabase Realtime ã® Broadcast** ã‚’çµŒç”±ã—ã¦è¡Œã†ã€‚`y-websocket` ã‚µãƒ¼ãƒãƒ¼ã¯ä½¿ã‚ãªã„ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©ã‚³ã‚¹ãƒˆå‰Šæ¸›ã®ãŸã‚ï¼‰
> - Supabase Realtime ã® Broadcast ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚µã‚¤ã‚ºä¸Šé™ã¯ **ç´„ 1MB**ã€‚å¤§é‡ãƒ†ã‚­ã‚¹ãƒˆã®ä¸€æ‹¬å¤‰æ›´ã¯å·®åˆ†ã§é€ä¿¡ã™ã‚‹ãŸã‚é€šå¸¸ã¯å•é¡Œãªã„ãŒã€å·¨å¤§ãªç”»åƒæŒ¿å…¥æ™‚ã¯ REST API çµŒç”±ã§ä¿å­˜ã™ã‚‹ã“ã¨

> [!IMPORTANT]
> - ãƒ­ãƒƒã‚¯ç®¡ç†ã¯ **Y.js Awareness ã®ã¿**ã€‚REST API ã«ãƒ­ãƒƒã‚¯ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯å­˜åœ¨ã—ãªã„
> - `PlotResponse.editingUsers` ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ­ãƒƒã‚¯åˆ¤å®šã«ã¯ä½¿ç”¨ã—ãªã„ï¼ˆAwarenessã‚’ä½¿ç”¨ã™ã‚‹ï¼‰ã€‚åˆæœŸãƒ­ãƒƒã‚¯çŠ¶æ…‹ã¯ Awareness æ¥ç¶šå¾…ã¡ã¨ãªã‚‹ï¼ˆã€Œæ¥ç¶šä¸­...ã€è¡¨ç¤ºï¼‰
> - PC ã§ã‚‚ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚ç·¨é›†å¯èƒ½ï¼ˆãƒ¢ãƒã‚¤ãƒ«éè¡¨ç¤ºã®åˆ¶é™ãªã—ï¼‰

> [!TIP]
> - é–‹ç™ºåˆæœŸï¼ˆMock ãƒ¢ãƒ¼ãƒ‰ï¼‰ã§ã¯ `useSectionLock` ã‚’ãƒ­ãƒ¼ã‚«ãƒ« state ã®ã¿ã§ç®¡ç†ã—ã€`useRealtimeSection` ã¯ä½•ã‚‚ã—ãªã„ no-op ã«ã™ã‚‹ã€‚è©³ç´°ã¯ [09-mock-development.md](./09-mock-development.md) ã®ã€ŒE.6 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç³» Hook ã® Mockã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‚ç…§
